"use strict";var ExhibitPageView=Backbone.View.extend({el:$("#js-pageContent"),events:{"click .js-exhibit-item":"exhibitItemView","hidden.bs.modal #js-exhibit-item":"exhibitView","click .js-blockquote":"showExhibitOverview","click #js-exhibit__overview":"toggleExhibitOverview","click .js-show-all-exhibit-items":"togglePrimarySourceSet","mouseenter .primarysource__link":"dotDotDot","mouseleave .primarysource__link":"killDotDotDot"},exhibitItemView:function(e){1<e.which||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||(e.preventDefault(),$.pjax({push:!0,scrollTo:!1,url:$(e.currentTarget).attr("href"),container:"#js-exhibit-item__container"}))},exhibitView:function(){0<$("#js-exhibit-item__container").children().length&&$.pjax({push:!0,scrollTo:!1,url:$("#js-exhibit-item .close").data("url"),container:"#js-exhibit-item__container"})},showExhibitOverview:function(){$(".js-exhibit__overview").triggerHandler("isTruncated")&&($(".js-exhibit__overview").trigger("destroy"),$(".js-exhibit__overview").css("height","auto"),$("#js-exhibit__overview").text("Read less"))},toggleExhibitOverview:function(){$(".js-exhibit__overview").triggerHandler("isTruncated")?($(".js-exhibit__overview").trigger("destroy"),$(".js-exhibit__overview").css("height","auto"),$("#js-exhibit__overview").text("Read less")):($(".js-exhibit__overview").css("height","400px").dotdotdot(),$("#js-exhibit__overview").text("Read full exhibition overview"))},togglePrimarySourceSet:function(){$(".js-exhibit-items-overflow").slideToggle(),"View all"===$($(".js-show-all-exhibit-items")[0]).text()?$(".js-show-all-exhibit-items").text("View fewer"):$(".js-show-all-exhibit-items").text("View all")},dotDotDot:function(e){$(e.currentTarget).find(".exhibit__caption").dotdotdot()},killDotDotDot:function(e){$(e.currentTarget).find(".exhibit__caption").trigger("destroy")},initCarousel:function(){$(".js-related-carousel").slick({infinite:!1,slidesToShow:4,slidesToScroll:1,responsive:[{breakpoint:900,settings:{slidesToShow:3}},{breakpoint:650,settings:{slidesToShow:2}}]})},pjax_beforeReplace:function(e){e.target!==$("#js-exhibit-item__container")[0]&&$("#js-exhibit-item").is(":visible")&&($(".modal-backdrop").remove(),$("body").removeClass("modal-open"))},pjax_beforeSend:function(e,i){i.setRequestHeader("X-Exhibit-Item","true")},pjax_end:function(i){return function(e){"js-exhibit-item__container"===e.target.id&&($("#js-exhibit-item__container").children().length&&!$("#js-exhibit-item").is(":visible")?$("#js-exhibit-item").modal():$("#js-exhibit-item__container").children().length||$("#js-exhibit-item").modal("hide")),"js-pageContent"===e.target.id&&(i.initCarousel(),$(".js-exhibit__overview").dotdotdot({callback:function(e){e?$("#js-exhibit__overview").text("Read full exhibition overview"):$(".js-exhibit__overview").css("height","auto")}}))}},initialize:function(){$("#js-exhibit-item__container").children().length&&$("#js-exhibit-item").modal(),this.bound_pjax_end=this.pjax_end(this),$(document).on("pjax:beforeSend","#js-exhibit-item__container",this.pjax_beforeSend),$(document).on("pjax:beforeReplace","#js-pageContent",this.pjax_beforeReplace),$(document).on("pjax:end","#js-pageContent",this.bound_pjax_end),this.initCarousel(),$(".js-exhibit__overview").dotdotdot({callback:function(e){e?$("#js-exhibit__overview").text("Read full exhibition overview"):$(".js-exhibit__overview").css("height","auto")}})},destroy:function(){$(document).off("pjax:beforeSend","#js-exhibit-item__container",this.pjax_beforeSend),$(document).off("pjax:beforeReplace","#js-pageContent",this.pjax_beforeReplace),$(document).off("pjax:end","#js-pageContent",this.bound_pjax_end),this.undelegateEvents()}});