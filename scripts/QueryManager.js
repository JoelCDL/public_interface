"use strict";var QueryManager=Backbone.Model.extend({defaultValues:{rq:"",view_format:"thumbnails",sort:"relevance",rows:"24",start:0},getQueryFromDOM:function(e){var r="[form="+e+"]";if(0<$(r).length){var t,a=$.extend({},{q:$(r+"[name=q]").val(),view_format:$(r+"[name=view_format]").val(),sort:$(r+"[name=sort]").val(),rows:$(r+"[name=rows]").val(),start:$(r+"[name=start]").val()});if(a.start&&(a.start=parseInt(a.start)),"js-facet"===e){t=$(r+".js-facet:visible").serializeArray();for(var s=$(r+".js-facet:hidden").serializeArray(),o=0;o<s.length;o++)"relation_ss"==s[o].name&&t.push(s[o])}else t=$(r+".js-filter").serializeArray();if(0<t.length)for(o=0;o<t.length;o++){var i=t[o];_.has(a,i.name)?a[i.name].push(i.value):a[i.name]=[i.value]}var n=$(r+"[name=rq]").serializeArray();if(0<n.length){a.rq=[];for(var l=0;l<n.length;l++)""!==n[l].value&&a.rq.push(n[l].value)}return a=_.defaults(a,{type_ss:"",facet_decade:"",repository_data:"",collection_data:"",rq:""})}return console.log("[ERROR]: QueryManager attempting to retrieve query parameters from "+e+" form when no form is in DOM."),{}},getItemInfoFromDOM:function(){if(0<$("[form=js-carouselForm]").length){var e={itemId:$("#js-objectViewport").data("item_id")||$("[form=js-carouselForm][name=itemId]").val()||"",referral:$("[form=js-carouselForm][name=referral]").val()||"",referralName:$("[form=js-carouselForm][name=referralName]").val()||""};return e.itemNumber=$('.js-item-link[data-item_id="'+e.itemId+'"]').data("item_number")||$("[form=js-carouselForm][name=itemNumber]").val()||"","collection"===e.referral&&(e.collection_data=parseInt($("[form=js-carouselForm][name=collection_url]").val())),"institution"===e.referral&&(e.repository_data=parseInt($("[form=js-carouselForm][name=repository_url]").val())),"campus"===e.referral&&(e.campus_slug=$("[form=js-carouselForm][name=campus_slug]").val()),e}return console.log("[ERROR]: QueryManager attempting to retrieve item information from js-carouselForm when no such form is in DOM."),{}},unsetItemInfo:function(){this.unset("itemId",{silent:!0}),this.unset("itemNumber",{silent:!0}),void 0!==this.get("referral")&&("institution"===this.get("referral")?this.unset("repository_data",{silent:!0}):"campus"===this.get("referral")?this.unset("campus_slug",{silent:!0}):"collection"===this.get("referral")&&this.unset("collection_data",{silent:!0}),this.unset("referral",{silent:!0}),this.unset("referralName",{silent:!0}))},initialize:function(){var e;$("[form=js-facet]").length?e=this.getQueryFromDOM("js-facet"):$("[form=js-carouselForm]").length&&(e=this.getQueryFromDOM("js-carouselForm"),e=_.extend(e,this.getItemInfoFromDOM())),e=_.omit(e,function(e){return _.isNull(e)}),this.set(e)},set:function(e,r,t){if(null===e)return this;var a,s;"object"==typeof e?(a=e,t=r):(a={})[e]=r,t=t||{},_.each(a,(s=this,function(e,r,t){void 0!==e&&(void 0!==s.defaultValues[r]&&s.defaultValues[r]===e||0===e.length&&"q"!==r)&&(delete t[r],_.isEmpty(t)?s.unset(r):s.unset(r,{silent:!0}))})),Backbone.Model.prototype.set.apply(this,[a,t])}});