"use strict";var qm,globalSearchForm,setupComponents=function(e,t){$("#js-facet").length?e.facetForm=e.facetForm||new FacetFormView({model:t,popstate:e.popstate}):e.facetForm&&(e.facetForm.destroy(),delete e.facetForm),$("#js-carouselContainer").length?e.carousel=e.carousel||new ItemView({model:t}):e.carousel&&(e.carousel.destroy(),delete e.carousel),$("#js-contactOwner").length?e.contactOwnerForm=e.contactOwnerForm||new ContactOwnerFormView:e.contactOwnerForm&&delete e.contactOwnerForm,$(".carousel-complex").length?e.complexCarousel=e.complexCarousel||new ComplexCarouselView({model:t}):e.complexCarousel&&(e.complexCarousel.destroy(),delete e.complexCarousel),$("#js-exhibit-title").length?e.exhibitPage=e.exhibitPage||new ExhibitPageView:e.exhibitPage&&(e.exhibitPage.destroy(),delete e.exhibitPage),$("#obj__osd").length?(e.viewer&&(e.viewer.destroy(),delete e.viewer,$("#obj__osd").empty()),$(".openseadragon-container").length&&$(".openseadragon-container").remove(),e.viewer=new OpenSeadragon({id:"obj__osd",toolbar:"obj__osd-toolbar",tileSources:[tileSources],zoomInButton:"obj__osd-button-zoom-in",zoomOutButton:"obj__osd-button-zoom-out",homeButton:"obj__osd-button-home",fullPageButton:"obj__osd-button-fullscreen",rotateLeftButton:"obj__osd-button-rotate-left",rotateRightButton:"obj__osd-button-rotate-right",showRotationControl:!0}),e.viewer.addHandler("home",function(e){e.eventSource.viewport.setRotation(0)})):e.viewer&&(e.viewer.destroy(),delete e.viewer),$("#js-exhibit-wrapper").length&&(e.grid=$("#js-exhibit-wrapper").isotope({layoutMode:"masonry",itemSelector:".js-grid-item",percentPosition:!0,masonry:{columnWidth:".js-grid-sizer"}})),$(".obj__heading").dotdotdot({ellipsis:"…",watch:"window",height:50,lastCharacter:{remove:[" ",",",";",".","!","?","[","]"]}}),$(".thumbnail__caption").dotdotdot({ellipsis:"…",watch:"window",height:30,lastCharacter:{remove:[" ",",",";",".","!","?","[","]"]}}),$(".carousel__thumbnail-caption").dotdotdot({ellipsis:"…",watch:"window",height:30,lastCharacter:{remove:[" ",",",";",".","!","?","[","]"]}}),$("#js-mosaicContainer").length&&($("#js-collectionPagination a.js-next").length?$("#js-mosaicContainer").infiniteScroll({path:"#js-collectionPagination a.js-next",append:"#js-mosaicContainer div.js-collectionMosaic",history:!1,hideNav:"#js-collectionPagination",debug:!1,status:"#js-loading"}):$("#js-loading").hide())},QueryManager=Backbone.Model.extend({defaultValues:{rq:"",view_format:"thumbnails",sort:"relevance",rows:"24",start:0},getQueryFromDOM:function(e){var t="[form="+e+"]";if(0<$(t).length){var a,i=$.extend({},{q:$(t+"[name=q]").val(),view_format:$(t+"[name=view_format]").val(),sort:$(t+"[name=sort]").val(),rows:$(t+"[name=rows]").val(),start:$(t+"[name=start]").val()});if(i.start&&(i.start=parseInt(i.start)),"js-facet"===e){a=$(t+".js-facet:visible").serializeArray();for(var o=$(t+".js-facet:hidden").serializeArray(),n=0;n<o.length;n++)"relation_ss"==o[n].name&&a.push(o[n])}else a=$(t+".js-filter").serializeArray();if(0<a.length)for(n=0;n<a.length;n++){var s=a[n];_.has(i,s.name)?i[s.name].push(s.value):i[s.name]=[s.value]}var r=$(t+"[name=rq]").serializeArray();if(0<r.length){i.rq=[];for(var l=0;l<r.length;l++)""!==r[l].value&&i.rq.push(r[l].value)}return _.defaults(i,{type_ss:"",facet_decade:"",repository_data:"",collection_data:"",rq:""})}return console.log("[ERROR]: QueryManager attempting to retrieve query parameters from "+e+" form when no form is in DOM."),{}},getItemInfoFromDOM:function(){if(0<$("[form=js-carouselForm]").length){var e={itemId:$("#js-objectViewport").data("item_id")||$("[form=js-carouselForm][name=itemId]").val()||"",referral:$("[form=js-carouselForm][name=referral]").val()||"",referralName:$("[form=js-carouselForm][name=referralName]").val()||""};return e.itemNumber=$('.js-item-link[data-item_id="'+e.itemId+'"]').data("item_number")||$("[form=js-carouselForm][name=itemNumber]").val()||"","collection"===e.referral&&(e.collection_data=parseInt($("[form=js-carouselForm][name=collection_url]").val())),"institution"===e.referral&&(e.repository_data=parseInt($("[form=js-carouselForm][name=repository_url]").val())),"campus"===e.referral&&(e.campus_slug=$("[form=js-carouselForm][name=campus_slug]").val()),e}return console.log("[ERROR]: QueryManager attempting to retrieve item information from js-carouselForm when no such form is in DOM."),{}},unsetItemInfo:function(){this.unset("itemId",{silent:!0}),this.unset("itemNumber",{silent:!0}),void 0!==this.get("referral")&&("institution"===this.get("referral")?this.unset("repository_data",{silent:!0}):"campus"===this.get("referral")?this.unset("campus_slug",{silent:!0}):"collection"===this.get("referral")&&this.unset("collection_data",{silent:!0}),this.unset("referral",{silent:!0}),this.unset("referralName",{silent:!0}))},initialize:function(){var e;$("[form=js-facet]").length?e=this.getQueryFromDOM("js-facet"):$("[form=js-carouselForm]").length&&(e=this.getQueryFromDOM("js-carouselForm"),e=_.extend(e,this.getItemInfoFromDOM())),e=_.omit(e,function(e){return _.isNull(e)}),this.set(e)},set:function(e,t,a){if(null===e)return this;var i,o;"object"==typeof e?(i=e,a=t):(i={})[e]=t,a=a||{},_.each(i,(o=this,function(e,t,a){void 0!==e&&(void 0!==o.defaultValues[t]&&o.defaultValues[t]===e||0===e.length&&"q"!==t)&&(delete a[t],_.isEmpty(a)?o.unset(t):o.unset(t,{silent:!0}))})),Backbone.Model.prototype.set.apply(this,[i,a])}}),ExhibitPageView=Backbone.View.extend({el:$("#js-pageContent"),events:{"click .js-exhibit-item":"exhibitItemView","hidden.bs.modal #js-exhibit-item":"exhibitView","click .js-blockquote":"showExhibitOverview","click #js-exhibit__overview":"toggleExhibitOverview","click .js-show-all-exhibit-items":"togglePrimarySourceSet","mouseenter .primarysource__link":"dotDotDot","mouseleave .primarysource__link":"killDotDotDot"},exhibitItemView:function(e){1<e.which||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||(e.preventDefault(),$.pjax({push:!0,scrollTo:!1,url:$(e.currentTarget).attr("href"),container:"#js-exhibit-item__container"}))},exhibitView:function(){0<$("#js-exhibit-item__container").children().length&&$.pjax({push:!0,scrollTo:!1,url:$("#js-exhibit-item .close").data("url"),container:"#js-exhibit-item__container"})},showExhibitOverview:function(){$(".js-exhibit__overview").triggerHandler("isTruncated")&&($(".js-exhibit__overview").trigger("destroy"),$(".js-exhibit__overview").css("height","auto"),$("#js-exhibit__overview").text("Read less"))},toggleExhibitOverview:function(){$(".js-exhibit__overview").triggerHandler("isTruncated")?($(".js-exhibit__overview").trigger("destroy"),$(".js-exhibit__overview").css("height","auto"),$("#js-exhibit__overview").text("Read less")):($(".js-exhibit__overview").css("height","400px").dotdotdot(),$("#js-exhibit__overview").text("Read full exhibition overview"))},togglePrimarySourceSet:function(){$(".js-exhibit-items-overflow").slideToggle(),"View all"===$($(".js-show-all-exhibit-items")[0]).text()?$(".js-show-all-exhibit-items").text("View fewer"):$(".js-show-all-exhibit-items").text("View all")},dotDotDot:function(e){$(e.currentTarget).find(".exhibit__caption").dotdotdot()},killDotDotDot:function(e){$(e.currentTarget).find(".exhibit__caption").trigger("destroy")},initCarousel:function(){$(".js-related-carousel").slick({infinite:!1,slidesToShow:4,slidesToScroll:1,responsive:[{breakpoint:900,settings:{slidesToShow:3}},{breakpoint:650,settings:{slidesToShow:2}}]})},pjax_beforeReplace:function(e){e.target!==$("#js-exhibit-item__container")[0]&&$("#js-exhibit-item").is(":visible")&&($(".modal-backdrop").remove(),$("body").removeClass("modal-open"))},pjax_beforeSend:function(e,t){t.setRequestHeader("X-Exhibit-Item","true")},pjax_end:function(t){return function(e){"js-exhibit-item__container"===e.target.id&&($("#js-exhibit-item__container").children().length&&!$("#js-exhibit-item").is(":visible")?$("#js-exhibit-item").modal():$("#js-exhibit-item__container").children().length||$("#js-exhibit-item").modal("hide")),"js-pageContent"===e.target.id&&(t.initCarousel(),$(".js-exhibit__overview").dotdotdot({callback:function(e){e?$("#js-exhibit__overview").text("Read full exhibition overview"):$(".js-exhibit__overview").css("height","auto")}}))}},initialize:function(){$("#js-exhibit-item__container").children().length&&$("#js-exhibit-item").modal(),this.bound_pjax_end=this.pjax_end(this),$(document).on("pjax:beforeSend","#js-exhibit-item__container",this.pjax_beforeSend),$(document).on("pjax:beforeReplace","#js-pageContent",this.pjax_beforeReplace),$(document).on("pjax:end","#js-pageContent",this.bound_pjax_end),this.initCarousel(),$(".js-exhibit__overview").dotdotdot({callback:function(e){e?$("#js-exhibit__overview").text("Read full exhibition overview"):$(".js-exhibit__overview").css("height","auto")}})},destroy:function(){$(document).off("pjax:beforeSend","#js-exhibit-item__container",this.pjax_beforeSend),$(document).off("pjax:beforeReplace","#js-pageContent",this.pjax_beforeReplace),$(document).off("pjax:end","#js-pageContent",this.bound_pjax_end),this.undelegateEvents()}}),FacetFormView=Backbone.View.extend({el:$("#js-pageContent"),events:{"submit #js-facet":"setRefineQuery","click .js-refine-filter-pill":"removeRefineQuery","change .js-facet":"setFacet","click .js-filter-pill":"removeFacet","click #thumbnails,#list":"toggleViewFormat","change #pag-dropdown__sort":"setSort","change #pag-dropdown__view":"setRows","click .js-prev,.js-next,a[data-start],button[data-start]":"setStart","change .pag-dropdown__select--unstyled":"setStart","click .js-item-link":"goToItemPage","click .js-a-check__link-deselect-all":"deselectAll","click .js-a-check__button-deselect-all":"deselectAll","click .js-a-check__link-select-all":"selectAll","click .js-a-check__button-select-all":"selectAll","click .js-clear-filters":"clearFilters","click .js-a-check__header":"toggleFacetDropdown","click .js-a-check__update":"updateFacets","click .js-rc-page":"paginateRelatedCollections","click .js-relatedCollection":"clearQuery"},setRefineQuery:function(e){this.model.set({start:0,rq:$.map($("input[name=rq]"),function(e){return $(e).val()})}),e.preventDefault()},removeRefineQuery:function(e){var t=$(e.currentTarget).data("slug");_.isNumber(t)&&(t=t.toString()),$('input[form="js-facet"][name="rq"][value="'+t+'"]').val(""),this.model.set({start:0,rq:_.without(this.model.get("rq"),t)})},setFacet:function(e){var t=$(e.currentTarget).attr("name"),a={start:0};a[t]=$.map($("input[name="+t+"]:checked"),function(e){return $(e).val()}),this.model.set(a)},removeFacet:function(e){var t=$(e.currentTarget).data("slug");"string"!=typeof t&&(t=String(t)),$("#"+t).prop("checked",!1);var a=$("#"+t).attr("name"),i=$("#"+t).attr("value"),o={start:0};o[a]=_.without(this.model.get(a),i),this.model.set(o)},toggleViewFormat:function(e){var t=$(e.currentTarget).attr("id");$("#view_format").prop("value",t),this.model.set({view_format:t})},setSort:function(e){this.model.set({start:0,sort:$(e.currentTarget).val()})},setRows:function(e){this.model.set({start:0,rows:$(e.currentTarget).val()})},setStart:function(e){var t;e.preventDefault(),"click"===e.type?t=$(e.currentTarget).data("start"):"change"===e.type&&(t=$(e.currentTarget).children("option:selected").attr("value")),$("#start").val(t),this.model.set({start:t})},goToItemPage:function(e){1<e.which||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||void 0!==$(e.currentTarget).data("item_number")&&(this.model.set({itemNumber:$(e.currentTarget).data("item_number"),itemId:$(e.currentTarget).data("item_id")},{silent:!0}),0<$("#js-institution").length?$("#js-institution").data("campus")?this.model.set({campus_slug:$("#js-institution").data("campus"),referral:"campus",referralName:$("#js-institution").data("referralname")},{silent:!0}):this.model.set({repository_data:$("#js-institution").data("institution"),referral:"institution",referralName:$("#js-institution").data("referralname")},{silent:!0}):0<$("#js-collection").length&&this.model.set({collection_data:$("#js-collection").data("collection"),referral:"collection",referralName:$("#js-collection").data("referralname")},{silent:!0}),e.preventDefault(),$.pjax({url:$(e.currentTarget).attr("href"),container:"#js-pageContent"}))},deselectAll:function(e){this.selectDeselectAll(e,!1)},selectAll:function(e){this.selectDeselectAll(e,!0)},selectDeselectAll:function(e,t){var a=$(e.currentTarget).parents(".check").find(".js-facet");a.prop("checked",t),a.trigger("change"),e.preventDefault()},toggleSelectDeselectAll:function(){for(var e=$(".check"),t=0;t<e.length;t++)!0==!$($(e[t]).find(".js-facet")).is(":not(:checked)")&&($(e[t]).find(".js-a-check__link-deselect-all").toggleClass("check__link-deselect-all--not-selected check__link-deselect-all--selected"),$(e[t]).find(".js-a-check__link-select-all").toggleClass("check__link-select-all--selected check__link-select-all--not-selected"),$(e[t]).find(".js-a-check__button-select-all").prop("disabled",!0),$(e[t]).find(".js-a-check__update").prop("disabled",!1)),!0===$(e[t]).find(".js-facet").is(":checked")&&$(e[t]).find(".js-a-check__button-deselect-all").prop("disabled",!1)},toggleTooltips:function(){for(var e=$('[data-toggle="tooltip"][aria-describedby]'),t=0;t<e.length;t++){var a=$(e[t]).attr("aria-describedby");$("#"+a).remove()}$('[data-toggle="tooltip"]').tooltip({placement:"top"})},clearFilters:function(){var e=$(".js-facet");e.prop("checked",!1),e.trigger("change")},toggleFacetDropdown:function(e){for(var t=$(".check__popdown--selected"),a=0;a<t.length;a++)$(t[a]).parent().find("input").attr("name")!==$(e.currentTarget).parent().find("input").attr("name")&&($(t[a]).toggleClass("check__popdown check__popdown--selected"),$(t[a]).prev(".js-a-check__header").children(".js-a-check__header-arrow-icon").toggleClass("fa-angle-down fa-angle-up"));$(e.currentTarget).next(".js-a-check__popdown").toggleClass("check__popdown check__popdown--selected"),$(e.currentTarget).children(".js-a-check__header-arrow-icon").toggleClass("fa-angle-down fa-angle-up")},updateFacets:function(e){e.preventDefault(),this.facetSearch()},facetSearch:function(){$.pjax({url:$("#js-facet").attr("action"),container:"#js-pageContent",data:this.model.toJSON(),traditional:!0})},paginateRelatedCollections:function(e){0<$("#js-institution").length?$("#js-institution").data("campus")?this.model.set({campus_slug:$("#js-institution").data("campus"),referral:"campus",referralName:$("#js-institution").data("referralname")},{silent:!0}):this.model.set({repository_data:$("#js-institution").data("institution"),referral:"institution",referralName:$("#js-institution").data("referralname")},{silent:!0}):0<$("#js-collection").length&&this.model.set({collection_data:$("#js-collection").data("collection"),referral:"collection",referralName:$("#js-collection").data("referralname")},{silent:!0});var t=this.model.toJSON();t.rc_page=$(e.currentTarget).data("rc_page"),$.ajax({data:t,traditional:!0,url:"/relatedCollections/",success:function(e){$("#js-relatedCollections").html(e)}})},clearQuery:function(){this.model.clear({silent:!0})},changeWidth:function(e){this.desktop=900<e},render:function(){if(!_.isEmpty(this.model.changed)&&!_.has(this.model.changed,"q"))if(this.desktop)this.facetSearch();else if(_.has(this.model.changed,"type_ss")||_.has(this.model.changed,"facet_decade")||_.has(this.model.changed,"repository_data")||_.has(this.model.changed,"collection_data")){var t=!1;_.each(this.model.changed,function(e){void 0===e&&(t=!0)}),t&&this.facetSearch(),_.each(this.model.changed,function(e,t){"type_ss"!==t&&"facet_decade"!==t&&"repository_data"!==t&&"collection_data"!==t||$(".facet-"+t).parents(".check").find(".js-a-check__update").prop("disabled",!1)})}else this.facetSearch()},pjax_end:function(t){return function(){var e;$("#js-facet").length&&("back"!==t.popstate&&"forward"!==t.popstate||(_.each($("form"),function(e){e.reset()}),e=t.model.getQueryFromDOM("js-facet"),t.model.set(e,{silent:!0}),t.popstate=null),t.toggleSelectDeselectAll(),t.toggleTooltips())}},pjax_popstate:function(t){return function(e){t.popstate=e.direction}},initialize:function(e){this.listenTo(this.model,"change",this.render),this.changeWidth($(window).width()),this.popstate=e.popstate?e.popstate:null,this.pjax_end(this)(),this.bound_pjax_end=this.pjax_end(this),this.bound_pjax_popstate=this.pjax_popstate(this),$(document).on("pjax:end","#js-pageContent",this.bound_pjax_end),$(document).on("pjax:popstate","#js-pageContent",this.bound_pjax_popstate)},destroy:function(){$(document).off("pjax:end","#js-pageContent",this.bound_pjax_end),$(document).off("pjax:popstate","#js-pageContent",this.bound_pjax_popstate),this.stopListening(),this.undelegateEvents()}}),ItemView=Backbone.View.extend({el:$("#js-pageContent"),carouselRows:8,carouselConfig:{infinite:!1,speed:300,variableWidth:!0,lazyLoad:"ondemand",rows:0},events:{"click #js-linkBack":"goToSearchResults","beforeChange .carousel":"loadSlides","afterChange .carousel":"carouselAfterChange","beforeChange .js-related-carousel":"exhibitCarouselBeforeChange","click .js-relatedExhibition":"goToExhibition","click .js-item-link":"goToItemPage","click .js-rc-page":"paginateRelatedCollections","click .js-relatedCollection":"selectRelatedCollection","click .js-disqus":"initDisqus","click #js-downloadModal":"sendGA","click #js-requestModal":"sendGA","click #js-downloadBtn":"sendGA","click #js-requestBtn":"sendGA"},sendGA:function(e){var t,a=e.target.dataset.label.toLowerCase();switch(e.target.id){case"js-downloadBtn":t="download";break;case"js-downloadModal":t="open download modal";break;case"js-requestBtn":t="request";break;case"js-requestModal":t="open request modal"}if("undefined"!=typeof ga){var i=get_cali_ga_dimensions();ga("caliga.send","event","buttons",t,a,i);var o=$("[data-ga-code]").data("ga-code");if(o&&("download"===t||"request"===t)){var n=o.replace(/-/g,"x"),s=get_inst_ga_dimensions();ga(n+".send","event","calisphere",t,a,s)}}},goToSearchResults:function(e){1<e.which||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||(this.model.unsetItemInfo(),e.preventDefault(),$.pjax({url:$(e.currentTarget).children("a").attr("href").split("?")[0],container:"#js-pageContent",data:this.model.toJSON(),traditional:!0}))},carouselAfterChange:function(e,t){if("undefined"!=typeof ga){var a=get_cali_ga_dimensions();ga("caliga.send","event","related content","paginate items",$(".carousel__search-results").data("set"),a)}if(this.beforeChange){var i;if(!0===this.addBefore){var o=$($(".js-carousel_item a")[0]);(i=this.model.toJSON()).start=Math.max(o.data("item_number")-this.carouselRows,0),i.rows=this.carouselRows,$.ajax({data:i,traditional:!0,url:"/carousel/",success:(c=this,d=t,function(e){if(d.currentSlide=c.carouselRows,d.slickAdd(e,!0),d.slideCount>5*c.carouselRows)for(var t=0;t<c.carouselRows;t++)d.slickRemove(d.slideCount,!0)})}),this.addBefore=!1}if(!0===this.addAfter){var n=$(".js-carousel_item")[$(".js-carousel_item").length-1];(i=this.model.toJSON()).start=$(n).children("a").data("item_number")+1,i.rows=this.carouselRows,$.ajax({data:i,traditional:!0,url:"/carousel/",success:(r=this,l=t,function(e){l.slickAdd(e);for(var t=0;t<r.carouselRows;t++)l.currentSlide=l.currentSlide-1,l.slickRemove(1,!0)})}),this.addAfter=!1}this.beforeChange=!1}else{var s=$("#js-carousel").data("numfound");1===$("[data-item_number="+(s-1)+"]").length&&t.slickGoTo(t.currentSlide+t.options.slidesToScroll+1),1===$("[data-item_number=0]").length&&t.slickGoTo(0)}var r,l,c,d},exhibitCarouselBeforeChange:function(){if("undefined"!=typeof ga){var e=get_cali_ga_dimensions();ga("caliga.send","event","related content","paginate exhibitions",$(".carousel__search-results").data("set"),e)}},goToExhibition:function(){if("undefined"!=typeof ga){var e=get_cali_ga_dimensions();ga("caliga.send","event","related content","select exhibition",$(".carousel__search-results").data("set"),e)}},loadSlides:function(e,t,a,i){this.beforeChange=!0;var o=$(".carousel").slick("getSlick").slideCount,n=$("#js-carousel").data("numfound");if(i<a&&o<n)0<=i&&i<this.carouselRows&&0===$("[data-item_number=0]").length&&(this.addBefore=!0);else if(a<i&&o<n){var s=n-1,r=o-i-this.carouselRows;r<this.carouselRows&&0<=r&&0===$("[data-item_number="+s+"]").length&&(this.addAfter=!0)}},goToItemPage:function(e){if(!(1<e.which||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)&&void 0!==$(e.currentTarget).data("item_number")){if("undefined"!=typeof ga){var t=get_cali_ga_dimensions();ga("caliga.send","event","related content","select item",$(".carousel__search-results").data("set"),t)}this.model.set({itemNumber:$(e.currentTarget).data("item_number"),itemId:$(e.currentTarget).data("item_id")},{silent:!0}),0<$("#js-institution").length?$("#js-institution").data("campus")?this.model.set({campus_slug:$("#js-institution").data("campus")},{silent:!0}):this.model.set({repository_data:$("#js-institution").data("institution")},{silent:!0}):0<$("#js-collection").length&&this.model.set({collection_data:$("#js-collection").data("collection")},{silent:!0}),e.preventDefault(),$.pjax({url:$(e.currentTarget).attr("href"),container:"#js-itemContainer"})}},paginateRelatedCollections:function(e){var t=this.model.toJSON();if(delete t.itemNumber,void 0!==e){if("undefined"!=typeof ga){var a=get_cali_ga_dimensions();ga("caliga.send","event","related content","paginate collections",$(".carousel__search-results").data("set"),a)}t.rc_page=$(e.currentTarget).data("rc_page")}else 2===$(".js-rc-page").length?t.rc_page=$($(".js-rc-page")[1]).data("rc_page")-1:t.rc_page=0;$.ajax({data:t,traditional:!0,url:"/relatedCollections/",success:function(e){$("#js-relatedCollections").html(e)}})},paginateRelatedExhibitions:function(){var e=this.model.toJSON();delete e.itemNumber,$.ajax({data:e,traditional:!0,url:"/relatedExhibitions/",success:function(e){$("#js-relatedExhibitions").html(e),$(".js-related-carousel").show(),$(".js-related-carousel").slick({infinite:!1,slidesToShow:4,slidesToScroll:4,rows:0,responsive:[{breakpoint:900,settings:{slidesToShow:3,slidesToScroll:3}},{breakpoint:650,settings:{slidesToShow:2,slidesToScroll:2}}]})}})},selectRelatedCollection:function(e){if(this.model.clear({silent:!0}),void 0!==$(e.currentTarget).data("relation"))e.preventDefault(),this.model.set({relation_ss:[$(e.currentTarget).data("relation")]}),$.pjax({url:$(e.currentTarget).attr("href").split("?")[0],container:"#js-pageContent",data:this.model.toJSON(),traditional:!0});else if("undefined"!=typeof ga){var t=get_cali_ga_dimensions();ga("caliga.send","event","related content","select collection",$(".carousel__search-results").data("set"),t)}},changeWidth:function(){for(var e=$("#js-carousel .slick-list").prop("offsetWidth"),t=$($(".js-carousel_item")[$(".carousel").slick("slickCurrentSlide")]),a=t.outerWidth()+parseInt(t.css("margin-right")),i=1,o=0;a<e&&0<t.length;)o++,t=t.next(),e-a>parseInt(t.css("margin-left"))&&i++,a+=t.outerWidth(!0);a-e<parseInt(t.css("margin-right"))&&o++,this.carouselRows=o,$(".carousel").slick("slickSetOption","slidesToShow",i,!1),$(".carousel").slick("slickSetOption","slidesToScroll",o,!0)},initCarousel:function(){var a,e=this.model.toJSON();e.rows=3*this.carouselRows,e.itemNumber?e.start=this.carouselInitStart=Math.max(e.itemNumber-this.carouselRows,0):e.start=0,e.init=!0,$.ajax({url:"/carousel/",data:e,traditional:!0,success:(a=this,function(e){var t=Object.assign({initialSlide:Math.min(a.carouselRows,a.model.attributes.itemNumber),slidesToShow:a.carouselRows,slidesToScroll:a.carouselRows},a.carouselConfig);t.initialSlide||(t.initialSlide=0),$("#js-carouselContainer").html(e),$(".carousel").show(),$(".carousel").slick(t),a.changeWidth()})})},initMediaPlayer:function(){var i;$("#obj__mejs").length&&(this.mediaplayer&&(this.mediaplayer.paused||this.mediaplayer.pause(),this.mediaplayer.remove(),delete this.mediaplayer),$(".media-player").mediaelementplayer({stretching:"responsive",success:(i=this,function(e,t,a){i.mediaplayer=a})}))},initDisqus:function(){if("undefined"!=typeof DISQUS)this.resetDisqus();else{$("#disqus_thread").empty();var e=$("#disqus_loader").data("disqus");$.ajaxSetup({cache:!0}),$.getScript("//"+e+".disqus.com/embed.js"),$.ajaxSetup({cache:!1})}$("#disqus_loader").hide()},resetDisqus:function(){$("#disqus_thread").empty(),DISQUS.reset({reload:!0,config:function(){this.forum=$("#disqus_loader").data("disqus"),this.page.url=window.location.href}})},pjax_beforeSend:function(e,t){t.setRequestHeader("X-From-Item-Page","true")},pjax_end:function(i){return function(){var e;"back"!==i.popstate&&"forward"!==i.popstate||($("#js-carouselForm").length&&(e=i.model.getItemInfoFromDOM(),i.model.set(e,{silet:!0})),$("#disqus_thread").length&&0<$("#disqus_thread").html().length&&i.resetDisqus(),i.popstate=null);var t=$(".carousel__item--selected");if(t.children("a").data("item_id")!==i.model.get("itemId")){t.find(".carousel__image--selected").toggleClass("carousel__image"),t.find(".carousel__image--selected").toggleClass("carousel__image--selected"),t.toggleClass("carousel__item"),t.toggleClass("carousel__item--selected");var a=$('.js-item-link[data-item_id="'+i.model.get("itemId")+'"]');a.find(".carousel__image").toggleClass("carousel__image--selected"),a.find(".carousel__image").toggleClass("carousel__image"),a.parent().toggleClass("carousel__item--selected"),a.parent().toggleClass("carousel__item")}i.paginateRelatedCollections(void 0),i.paginateRelatedExhibitions(),i.initMediaPlayer()}},pjax_popstate:function(t){return function(e){t.popstate=e.direction}},initialize:function(){if($("#js-carouselForm").length){var e=this.model.getQueryFromDOM("js-carouselForm");e=$.extend(e,this.model.getItemInfoFromDOM()),this.model.set(e,{silent:!0})}else this.model.set({itemId:$("#js-itemContainer").data("itemid")},{silent:!0});this.initCarousel(),this.paginateRelatedCollections(),this.paginateRelatedExhibitions(),this.initMediaPlayer(),$("#disqus_thread").length&&0<$("#disqus_thread").html().length&&this.resetDisqus(),this.bound_pjax_end=this.pjax_end(this),this.bound_pjax_popstate=this.pjax_popstate(this),$(document).on("pjax:beforeSend","#js-itemContainer",this.pjax_beforeSend),$(document).on("pjax:end","#js-itemContainer",this.bound_pjax_end),$(document).on("pjax:popstate","#js-pageContent",this.bound_pjax_popstate)},destroy:function(){$(document).off("pjax:beforeSend","#js-itemContainer",this.pjax_beforeSend),$(document).off("pjax:end","#js-itemContainer",this.bound_pjax_end),$(document).off("pjax:popstate","#js-pageContent",this.bound_pjax_popstate),this.undelegateEvents(),this.model.unsetItemInfo()}}),ComplexCarouselView=Backbone.View.extend({el:$("#js-pageContent"),carouselConfig:{infinite:!1,speed:300,variableWidth:!0,slidesToShow:15,slidesToScroll:15,lazyLoad:"ondemand"},events:{"click .js-set-link":"getSet","click .js-component-link":"getComponent","afterChange .carousel-complex__item-container":"afterChange"},getSet:function(e){1<e.which||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||(e.preventDefault(),$.pjax({type:"GET",url:$(e.currentTarget).attr("href"),container:"#js-itemContainer",traditional:!0,scrollTo:440}))},getComponent:function(e){if(!(1<e.which||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)){var t={order:$(e.currentTarget).data("item_id")};e.preventDefault(),$.pjax({type:"GET",url:$(e.currentTarget).attr("href").split("?")[0],container:"#js-itemContainer",data:t,traditional:!0,scrollTo:440})}},afterChange:function(e,t){this.changeWidth(e,t),this.checkEdges(e,t)},checkEdges:function(e,t){void 0===t&&(t=$(".carousel-complex__item-container").slick("getSlick")),0!==t.slickCurrentSlide()&&t.slickCurrentSlide()<t.getOption("slidesToScroll")&&t.setOption("slidesToScroll",t.slickCurrentSlide(),!0),t.slickCurrentSlide()+t.getOption("slidesToScroll")+1===t.slideCount&&(t.setOption("slidesToShow",1,!1),t.setOption("slidesToScroll",1,!0))},changeWidth:function(e,t){void 0===t&&(t=$(".carousel-complex__item-container").slick("getSlick"));for(var a=$(".carousel-complex__item-container .slick-list").prop("offsetWidth"),i=$(".carousel-complex__item-container [data-slick-index="+t.slickCurrentSlide()+"]"),o=i.outerWidth()+parseInt(i.css("margin-right")),n=1,s=0;o<a&&0<i.length;)s++,i=i.next(),a-o>parseInt(i.css("margin-left"))&&n++,o+=i.outerWidth(!0);o-a<parseInt(i.css("margin-right"))&&s++,t.slickSetOption("slidesToShow",n,!1),t.slickSetOption("slidesToScroll",s,!0)},initCarousel:function(){$(".carousel-complex").show(),$(".carousel-complex__item-container").slick(this.carouselConfig),0<$(".carousel-complex__item--selected").length?$(".carousel-complex__item-container").slick("slickGoTo",$(".carousel-complex__item--selected .carousel-complex__link").data("item_id")):0<$(".carousel-complex__tile--selected").length&&$(".carousel-complex__item-container").slick("slickGoTo",$(".carousel-complex__tile--selected .carousel-complex__link").data("item_id"))},pjax_end:function(e){return function(){$(".carousel-complex").is(":hidden")&&e.initialize()}},initialize:function(){var e;this.initCarousel(),imagesLoaded(".carousel-complex__item-container img",(e=this,function(){e.changeWidth()})),this.bound_pjax_end=this.pjax_end(this),$(document).on("pjax:end","#js-pageContent",this.bound_pjax_end)},destroy:function(){$(document).off("pjax:end","#js-pageContent",this.bound_pjax_end),this.undelegateEvents()}}),GlobalSearchFormView=Backbone.View.extend({el:$("body"),events:{"submit #js-searchForm,#js-footSearch":"clearAndSubmit","click .header__mobile-nav-button":"toggleMobileMenu","click .header__mobile-search-button":"toggleMobileSearch","click .js-global-header-logo":"clearQueryManager"},navOpenState:!0,searchOpenState:!0,clearAndSubmit:function(e){this.model.set({q:$(e.currentTarget).find("input[name=q]").val()},{silent:!0}),this.model.trigger("change:q"),e.preventDefault()},setAttrs:function(e,t,a){t&&a&&(!1===e?(t.classList.add("is-closed"),t.classList.remove("is-open"),a.setAttribute("aria-expanded",!1)):(t.classList.add("is-open"),t.classList.remove("is-closed"),a.setAttribute("aria-expanded",!0)))},watchHeaderWidth:function(n){return function(e){var t=document.querySelector(".header__search"),a=document.querySelector(".header__mobile-search-button"),i=document.querySelector(".header__nav"),o=document.querySelector(".header__mobile-nav-button");e.matches?(n.navOpenState=!0,n.searchOpenState=!0):(n.navOpenState=!1,n.searchOpenState=!1),t&&n.setAttrs(n.searchOpenState,t,a),n.setAttrs(n.navOpenState,i,o)}},toggleMobileMenu:function(e){var t=document.querySelector(".header__nav");!0===this.navOpenState?this.navOpenState=!1:this.navOpenState=!0,this.setAttrs(this.navOpenState,t,e.currentTarget)},toggleMobileSearch:function(e){var t=document.querySelector(".header__search");!0===this.searchOpenState?this.searchOpenState=!1:this.searchOpenState=!0,this.setAttrs(this.searchOpenState,t,e.currentTarget)},clearQueryManager:function(){_.isEmpty(this.model.attributes)||this.model.clear({silent:!0})},initialize:function(){this.listenTo(this.model,"change:q",this.render),$(document).on("pjax:beforeReplace","#js-pageContent",this.pjax_beforeReplace);var e=window.matchMedia("(min-width: 650px)");this.watchHeaderWidth(this)(e),e.addListener(this.watchHeaderWidth(this))},closeMenu:function(){$(".js-global-header__search").addClass("global-header__search"),$(".js-global-header__search").removeClass("global-header__search--selected"),$(".js-global-header__mobile-links").addClass("global-header__mobile-links"),$(".js-global-header__mobile-links").removeClass("global-header__mobile-links--selected")},render:function(){if(this.model.has("q")){var e=this.model.get("q");this.model.clear({silent:!0}),this.model.set({q:e},{silent:!0}),$.pjax({url:$("#js-searchForm").attr("action"),container:"#js-pageContent",data:this.model.toJSON()})}else this.model.clear({silent:!0}),$.pjax({url:$("#js-searchForm").attr("action"),container:"#js-pageContent",data:{q:""}});var t;_.each($("#js-searchForm, #js-footerSearch"),(t=this.model,function(e){$("input[name=q][form="+$(e).attr("id")+"]").val(t.get("q"))}))},changeWidth:function(e){void 0!==this.facetForm&&this.facetForm.changeWidth(e),void 0!==this.carousel&&this.carousel.changeWidth(e),void 0!==this.complexCarousel&&this.complexCarousel.changeWidth(e)},pjax_beforeReplace:function(){0<$("#js-mosaicContainer").length&&$("#js-collectionPagination").children().length&&$("#js-mosaicContainer").infiniteScroll("destroy")},pjax_end:function(){this.closeMenu()}}),ContactOwnerFormView=Backbone.View.extend({el:$("#js-contactOwner"),events:{"change #contactOwner-requestReason":"updateSubject",submit:"submitForm","blur #contactOwner-verifyEmail":"verifyEmail","change #contactOwner-demographic":"otherEditable"},updateSubject:function(e){$(".js-requestReason").text($(e.currentTarget).val())},verifyEmail:function(e){var t=$(e.currentTarget);t.val()!==$("#contactOwner-email").val()?t.parent().hasClass("has-error")||(t.parent().addClass("has-error"),$(t.siblings("label")[0]).text("Verify Email: Your emails do no match."),$("#contactOwner-submit").prop("disabled",!0)):t.parent().hasClass("has-error")&&(t.parent().removeClass("has-error"),$(t.siblings("label")[0]).text("Verify Email:"),$("#contactOwner-submit").prop("disabled",!1))},otherEditable:function(e){"other"===$(e.currentTarget).val()?$("#contactOwner-speicifedDemographic").prop("disabled",!1):($("#contactOwner-speicifedDemographic").val(""),$("#contactOwner-speicifedDemographic").prop("disabled",!0))},submitForm:function(e){e.preventDefault();var t=$("#js-contactOwner").serializeArray(),a=!0;$("#contactOwner-email").val()!==$("#contactOwner-verifyEmail").val()&&($("#contactOwner-verifyEmail").parent().hasClass("has-error")||($("#contactOwner-verifyEmail").parent().addClass("has-error"),$($("#contactOwner-verifyEmail").siblings("label")[0]).text("Verify Email: Your emails do no match."),$("#contactOwner-submit").prop("disabled",!0)),a=!1),_.each(t,function(e){_.isEmpty(e.value)?(a=!1,$("[form=js-contactOwner][name="+e.name+"]").parent().addClass("has-error")):$("[form=js-contactOwner][name="+e.name+"]").parent().hasClass("has-error")&&$("[form=js-contactOwner][name="+e.name+"]").parent().removeClass("has-error")}),a&&$.ajax({url:$(e.currentTarget).attr("action"),data:t,traditional:!0,success:function(e){$("#js-contactOwnerForm").html(e)}})}});function sessionStorageWarning(){Modernizr.sessionstorage||$("body").prepend($("<div/>",{class:"container-fluid"}).append($("<div/>",{class:"alert alert-warning alert-dismissible",role:"alert"}).text("Some features on the Calisphere beta site do not yet work in private browsing mode. For an optimal experience, please disable private browsing while on this site.").append('<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>')))}function timeoutGACallback(e,t){var a=!1;function i(){a||(a=!0,e())}return setTimeout(i,t||1e3),i}function get_cali_ga_dimensions(){var e=$("[data-ga-dim1]").data("ga-dim1"),t=$("[data-ga-dim2]").data("ga-dim2"),a=Modernizr.sessionstorage.toString(),i=$("[data-ga-dim4]").data("ga-dim4"),o={};return e&&(o.dimension1=e),t&&(o.dimension2=t),a&&(o.dimension3=a),i&&(o.dimension4=i),o}function get_inst_ga_dimensions(){var e=$("[data-ga-dim1]").data("ga-dim1"),t=$("[data-ga-dim2]").data("ga-dim2"),a={};return e&&(a.dimension1=e),t&&(a.dimension2=t),a}"undefined"==typeof console&&(console={log:function(){}}),$(document).on("pjax:timeout",function(){return!1}),$(document).ready(function(){var e;on_ready_pjax_end_handler(),"undefined"!=typeof ga&&($("body").on("click",'a[href^="http://"], a[href^="https://"], button[onclick^="location.href=\'http://"], button[onclick^="location.href=\'https://"]',function(){var e="";if($(this).attr("href"))e=$(this).attr("href");else if($(this).attr("onclick")){var t=$(this).attr("onclick");e=t.slice(15,t.length-2)}var a=get_cali_ga_dimensions();return a.transport="beacon",a.hitCallback=timeoutGACallback(function(){document.location=e}),ga("caliga.send","event","outbound","click",e,a),!1}),$(".button__contact-owner").on("click",function(){var e=$(this).attr("href"),t=get_cali_ga_dimensions();return t.transport="beacon",t.hitCallback=timeoutGACallback(function(){document.location=e}),ga("caliga.send","event","buttons","contact",e,t),!1})),sessionStorageWarning();var t=!1,a=200;function i(){new Date-e<a?setTimeout(i,a):(t=!1,globalSearchForm&&globalSearchForm.changeWidth($(window).width()))}$(window).resize(function(){e=new Date,!1===t&&(t=!0,setTimeout(i,a))}),$(".home").length||($.pjax.defaults.timeout=5e3,$(document).pjax("a[data-pjax=js-pageContent]","#js-pageContent"),qm=new QueryManager,globalSearchForm=new GlobalSearchFormView({model:qm}),setupComponents(globalSearchForm,qm),$(document).on("pjax:success",function(e,t,a,i,o){var n=o.context.find("meta[property=og\\:type]").nextUntil($("meta[name=twitter\\:creator]")),s=$("head").find("meta[property=og\\:type]");s.nextUntil($("meta[name=twitter\\:creator]")).remove(),$.each($(n).get().reverse(),function(e,t){$(t).insertAfter(s)})}),$(document).on("pjax:end","#js-pageContent",function(){globalSearchForm.pjax_end(),$("#js-facet").length||$("#js-objectViewport").length||qm.clear({silent:!0}),setupComponents(globalSearchForm,qm),globalSearchForm.popstate=null}),$(document).on("pjax:send",function(){NProgress.start()}),$(document).on("pjax:complete",function(){NProgress.done()}),$(document).on("pjax:popstate",function(e){globalSearchForm.popstate=e.direction}))});var on_ready_pjax_end_handler=function(){if("undefined"!=typeof ga){var e=get_cali_ga_dimensions();ga("caliga.set","location",window.location.href),ga("caliga.send","pageview",e);var t=$("[data-ga-code]").data("ga-code");if(t){var a=t.replace(/-/g,"x");ga("create",t,"auto",{name:a}),ga(a+".set","anonymizeIp",!0),ga(a+".set","location",window.location.href);var i=get_inst_ga_dimensions();ga(a+".send","pageview",i)}}if($("#titlesearch__field").length){var o=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("title"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:"/collections/titles.json"});$("#titlesearch__field").typeahead(null,{name:"collections",display:"title",limit:10,source:o}).on("keydown",function(e){13===e.which&&e.preventDefault()}).bind("typeahead:selected",function(e,t){window.location=t.uri})}};if($(document).on("pjax:end",on_ready_pjax_end_handler),!("backgroundBlendMode"in document.body.style)){var html=document.getElementsByTagName("html")[0];html.className=html.className+" no-background-blend-mode"}