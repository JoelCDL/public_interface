"use strict";var FacetFormView=Backbone.View.extend({el:$("#js-pageContent"),events:{"submit #js-facet":"setRefineQuery","click .js-refine-filter-pill":"removeRefineQuery","change .js-facet":"setFacet","click .js-filter-pill":"removeFacet","click #thumbnails,#list":"toggleViewFormat","change #pag-dropdown__sort":"setSort","change #pag-dropdown__view":"setRows","click .js-prev,.js-next,a[data-start],button[data-start]":"setStart","change .pag-dropdown__select--unstyled":"setStart","click .js-item-link":"goToItemPage","click .js-a-check__link-deselect-all":"deselectAll","click .js-a-check__button-deselect-all":"deselectAll","click .js-a-check__link-select-all":"selectAll","click .js-a-check__button-select-all":"selectAll","click .js-clear-filters":"clearFilters","click .js-a-check__header":"toggleFacetDropdown","click .js-a-check__update":"updateFacets","click .js-rc-page":"paginateRelatedCollections","click .js-relatedCollection":"clearQuery"},setRefineQuery:function(e){this.model.set({start:0,rq:$.map($("input[name=rq]"),function(e){return $(e).val()})}),e.preventDefault()},removeRefineQuery:function(e){var t=$(e.currentTarget).data("slug");_.isNumber(t)&&(t=t.toString()),$('input[form="js-facet"][name="rq"][value="'+t+'"]').val(""),this.model.set({start:0,rq:_.without(this.model.get("rq"),t)})},setFacet:function(e){var t=$(e.currentTarget).attr("name"),a={start:0};a[t]=$.map($("input[name="+t+"]:checked"),function(e){return $(e).val()}),this.model.set(a)},removeFacet:function(e){var t=$(e.currentTarget).data("slug");"string"!=typeof t&&(t=String(t)),$("#"+t).prop("checked",!1);var a=$("#"+t).attr("name"),n=$("#"+t).attr("value"),c={start:0};c[a]=_.without(this.model.get(a),n),this.model.set(c)},toggleViewFormat:function(e){var t=$(e.currentTarget).attr("id");$("#view_format").prop("value",t),this.model.set({view_format:t})},setSort:function(e){this.model.set({start:0,sort:$(e.currentTarget).val()})},setRows:function(e){this.model.set({start:0,rows:$(e.currentTarget).val()})},setStart:function(e){var t;e.preventDefault(),"click"===e.type?t=$(e.currentTarget).data("start"):"change"===e.type&&(t=$(e.currentTarget).children("option:selected").attr("value")),$("#start").val(t),this.model.set({start:t})},goToItemPage:function(e){1<e.which||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||void 0!==$(e.currentTarget).data("item_number")&&(this.model.set({itemNumber:$(e.currentTarget).data("item_number"),itemId:$(e.currentTarget).data("item_id")},{silent:!0}),0<$("#js-institution").length?$("#js-institution").data("campus")?this.model.set({campus_slug:$("#js-institution").data("campus"),referral:"campus",referralName:$("#js-institution").data("referralname")},{silent:!0}):this.model.set({repository_data:$("#js-institution").data("institution"),referral:"institution",referralName:$("#js-institution").data("referralname")},{silent:!0}):0<$("#js-collection").length&&this.model.set({collection_data:$("#js-collection").data("collection"),referral:"collection",referralName:$("#js-collection").data("referralname")},{silent:!0}),e.preventDefault(),$.pjax({url:$(e.currentTarget).attr("href"),container:"#js-pageContent"}))},deselectAll:function(e){this.selectDeselectAll(e,!1)},selectAll:function(e){this.selectDeselectAll(e,!0)},selectDeselectAll:function(e,t){var a=$(e.currentTarget).parents(".check").find(".js-facet");a.prop("checked",t),a.trigger("change"),e.preventDefault()},toggleSelectDeselectAll:function(){for(var e=$(".check"),t=0;t<e.length;t++){!0===!$($(e[t]).find(".js-facet")).is(":not(:checked)")&&($(e[t]).find(".js-a-check__link-deselect-all").toggleClass("check__link-deselect-all--not-selected check__link-deselect-all--selected"),$(e[t]).find(".js-a-check__link-select-all").toggleClass("check__link-select-all--selected check__link-select-all--not-selected"),$(e[t]).find(".js-a-check__button-select-all").prop("disabled",!0),$(e[t]).find(".js-a-check__update").prop("disabled",!1)),!0===$(e[t]).find(".js-facet").is(":checked")&&$(e[t]).find(".js-a-check__button-deselect-all").prop("disabled",!1)}},toggleTooltips:function(){for(var e=$('[data-toggle="tooltip"][aria-describedby]'),t=0;t<e.length;t++){var a=$(e[t]).attr("aria-describedby");$("#"+a).remove()}$('[data-toggle="tooltip"]').tooltip({placement:"top"})},clearFilters:function(){var e=$(".js-facet");e.prop("checked",!1),e.trigger("change")},toggleFacetDropdown:function(e){for(var t=$(".check__popdown--selected"),a=0;a<t.length;a++)$(t[a]).parent().find("input").attr("name")!==$(e.currentTarget).parent().find("input").attr("name")&&($(t[a]).toggleClass("check__popdown check__popdown--selected"),$(t[a]).prev(".js-a-check__header").children(".js-a-check__header-arrow-icon").toggleClass("fa-angle-down fa-angle-up"));$(e.currentTarget).next(".js-a-check__popdown").toggleClass("check__popdown check__popdown--selected"),$(e.currentTarget).children(".js-a-check__header-arrow-icon").toggleClass("fa-angle-down fa-angle-up")},updateFacets:function(e){e.preventDefault(),this.facetSearch()},facetSearch:function(){$.pjax({url:$("#js-facet").attr("action"),container:"#js-pageContent",data:this.model.toJSON(),traditional:!0})},paginateRelatedCollections:function(e){0<$("#js-institution").length?$("#js-institution").data("campus")?this.model.set({campus_slug:$("#js-institution").data("campus"),referral:"campus",referralName:$("#js-institution").data("referralname")},{silent:!0}):this.model.set({repository_data:$("#js-institution").data("institution"),referral:"institution",referralName:$("#js-institution").data("referralname")},{silent:!0}):0<$("#js-collection").length&&this.model.set({collection_data:$("#js-collection").data("collection"),referral:"collection",referralName:$("#js-collection").data("referralname")},{silent:!0});var t=this.model.toJSON();t.rc_page=$(e.currentTarget).data("rc_page"),$.ajax({data:t,traditional:!0,url:"/relatedCollections/",success:function(e){$("#js-relatedCollections").html(e)}})},clearQuery:function(){this.model.clear({silent:!0})},changeWidth:function(e){this.desktop=900<e},render:function(){if(!_.isEmpty(this.model.changed)&&!_.has(this.model.changed,"q"))if(this.desktop)this.facetSearch();else if(_.has(this.model.changed,"type_ss")||_.has(this.model.changed,"facet_decade")||_.has(this.model.changed,"repository_data")||_.has(this.model.changed,"collection_data")){var t=!1;_.each(this.model.changed,function(e){void 0===e&&(t=!0)}),t&&this.facetSearch(),_.each(this.model.changed,function(e,t){"type_ss"!==t&&"facet_decade"!==t&&"repository_data"!==t&&"collection_data"!==t||$(".facet-"+t).parents(".check").find(".js-a-check__update").prop("disabled",!1)})}else this.facetSearch()},pjax_end:function(t){return function(){if($("#js-facet").length){var e;if("back"===t.popstate||"forward"===t.popstate)_.each($("form"),function(e){e.reset()}),e=t.model.getQueryFromDOM("js-facet"),t.model.set(e,{silent:!0}),t.popstate=null;t.toggleSelectDeselectAll(),t.toggleTooltips()}}},pjax_popstate:function(t){return function(e){t.popstate=e.direction}},initialize:function(e){this.listenTo(this.model,"change",this.render),this.changeWidth($(window).width()),this.popstate=e.popstate?e.popstate:null,this.pjax_end(this)(),this.bound_pjax_end=this.pjax_end(this),this.bound_pjax_popstate=this.pjax_popstate(this),$(document).on("pjax:end","#js-pageContent",this.bound_pjax_end),$(document).on("pjax:popstate","#js-pageContent",this.bound_pjax_popstate)},destroy:function(){$(document).off("pjax:end","#js-pageContent",this.bound_pjax_end),$(document).off("pjax:popstate","#js-pageContent",this.bound_pjax_popstate),this.stopListening(),this.undelegateEvents()}});